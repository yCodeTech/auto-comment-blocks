name: Auto Create Labels

on:
    push:
        branches:
            - master
        paths:
            - ".github/workflows/auto-create-labels.yml"

jobs:
    create-labels:
        runs-on: ubuntu-latest
        permissions:
            issues: write
        env:
            LABELS_JSON: |
                [
                  {"name": "composer", "color": "817156", "description": ""},
                  {"name": "npm", "color": "c2e0c6", "description": ""},
                  {"name": "dependabot", "color": "ECE9F4", "description": ""},
                  {"name": "dependencies", "color": "2B8402", "description": ""}
                ]
        steps:
            - uses: actions/github-script@v7
              with:
                  script: |
                      const labels = JSON.parse(process.env.LABELS_JSON);
                      for (const label of labels) {
                        try {
                          await github.rest.issues.createLabel({
                            owner: context.repo.owner,
                            repo: context.repo.repo,
                            name: label.name,
                            description: label.description || '',
                            color: label.color
                          });
                        } catch (error) {
                          // Check if the error is because the label already exists
                          if (error.status === 422) {
                            console.log(`Label '${label.name}' already exists. Skipping.`);
                          } else {
                            // Log other errors
                            console.error(`Error creating label '${label.name}': ${error}`);
                          }
                        }
                      }
